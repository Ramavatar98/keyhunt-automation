name: KeyHunt Automation

on:
  workflow_dispatch:  # Manually Run
  push:
    branches:
      - main

jobs:
  run-keyhunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install Dependencies
        run: |
          pkg update && pkg upgrade
          pkg install git -y
          pkg install build-essential -y
          pkg install libssl-dev -y
          pkg install libgmp-dev -y
          git clone https://github.com/Ramavatar98/keyhunt-.git
          cd keyhunt-
          make legacy

      - name: Run KeyHunt
        run: |
           cd keyhunt-
           
           ./keyhunt -m address  -f tests/66.txt -b 66 -l compress -q -s 10

      - name: Check for KeyFound
        run: |
          if [ -f KEYFOUNDKEYFOUND.txt ]; then
            echo "Key Found! Saving..."
            TIMESTAMP=$(date "+%Y-%m-%d %H:%M:%S")
            echo "[$TIMESTAMP] $(cat KEYFOUNDKEYFOUND.txt)" >> found_keys.log

            # Commit Data
            git config --global user.name "GitHub Actions"
            git config --global user.email "actions@github.com"
            git add found_keys.log
            git commit -m "New key found on $TIMESTAMP"
            git push

            # Send Email Notification
            echo "New Key Found: $(cat KEYFOUNDKEYFOUND.txt)" | mail -s "New Key Found!" g98655545@gmail.com

            rm KEYFOUNDKEYFOUND.txt
          fi
          
